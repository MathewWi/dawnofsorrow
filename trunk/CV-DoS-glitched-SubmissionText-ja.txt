*DawnOfSorrowTAS* DS 悪魔城ドラキュラ 蒼月の十字架 TAS in 08:20.11 by gocha

悪魔城ドラキュラ 蒼月の十字架は、変態的なTASでおなじみの探索型悪魔城シリーズの作品であり、悪魔城ドラキュラ 暁月の円舞曲の続編です。

このスピードラン（タイムアタック）は通常難易度にてグッドエンドを最速で迎えることを目指しています。事前のセーブデータは一切ない状態からゲームを始めていますが、有名な壁抜けバグの変形技を利用することで、<em>8分20.11秒</em>での攻略を実現しています。ゲーム内時間での攻略タイムは<em>00:07:18（26310フレーム）</em>になるはずですが、バグによって書き換えられてしまう都合上、ゲームクリア後の表示は00:43:43になっています。

- 使用エミュレータ: <a class="ex-ref" href="http://tasvideos.org/forum/p/210670#210670">DeSmuME 0.9.4+</a>
-- タイミング周りのエミュレーションが不正確なため、しばしば<em>実機以上のラグが発生</em>します。
-- <em>OpenGL</em>がおすすめです。OpenGLでもSoftRasterizerでも基本的には問題ないのですが、SoftRasterizerはやや拡大周りが変な感じです。
- 最短時間での攻略を目指す（グッドエンドでの攻略）
- ゲーム内のバグを利用 / 壁抜けあり
- 運調整（Luck manipulation((通常ランダムな要素を、何度も撮り直しを繰り返して成功させるTASの手法。より効率的に成功を導くために、ゲーム内部の乱数が都合良く変化するような動きを交えることがしばしばある。蒼月の十字架においては、攻撃やバックダッシュがそれにあたる。))）あり（ソウルやアイテムの出現、ボスの動きなどに対して利用）
- 時間節約のための被ダメージあり
- ジャンル: 探索型2Dアクション

** 動画について

この動画の攻略プロセスはこんな感じです。

+ プロローグ
+ ヨーコとユリウスに会い、魔封陣1を入手する
+ アクスアーマーからアクスを入手する
+ フライングアーマーを倒す
+ バロールを倒す
+ 後のバグ利用のためにセーブする
+ 魔封陣2を入手する
+ ドミトリーを倒す
+ <em>壁抜け</em>を実行して必要な条件をそろえた後、ゲームを中断・再開する
+ ワープルームから深淵にワープして最後の部屋に突入。<em>なお、この城は数秒後に自動的に消滅する</em>

サキュバスバグと呼ばれる有名な壁抜けバグを利用することで、一瞬にして大量のソウルやアイテムを得ることができるというのは、結構よく知られているようです。サキュバスバグは若干のスピードランでも用いられているのですが、サキュバスのソウルを得るためには悪魔城最上階まで行かなければなりませんでした。

しかし、制作中にサキュバスバグの応用法（イベント会話を利用した必殺技キャンセル）を発見したことで、これまでよりもずっと早い段階で壁抜けできるようになりました。さらに、壁抜けの効能に関してもあれこれと検証してみた結果、ワープルームを有効にできること、メナスと戦わずにクリアできることがわかりました。

エミュレータがとってもとってもラグいので、ラグを主としたフレーム単位のロスはそれほど厳密には気にしてないです（でも基本的には最善を尽くしてます！）。かわりに、全体の戦略やルート最適化やバグ探しなどで、基礎の構築をがんばりました。

** 技いろいろ

見つけたものいろいろ o(＞ヮ＜)o

*** バックダッシュ

バックダッシュ+ジャンプとバックダッシュ+しゃがみという2つの移動方法が考えられました。どちらがより速いのか知るべく、平地での平均速度を比較してみました。

- バックダッシュ+ジャンプ: (13784+13232+12680+12128+11576+11024+10472+9920+9368+8816+8264+7712)/12 = 10748 
- バックダッシュ+しゃがみ: (13784+13232+12680+12128+11576+11024+8624+0)/8 = 10381 (8フレーム周期が全周期中最速)

このため基本的にはジャンプしながら移動しているのですが、下り坂やより早いタイミングでジャンプしたい場面ではしゃがみながら移動しています。ときどき乱数調整にも使っています。

じつは「前、無入力、後ろ+バックダッシュ」というもうひとつの移動方法も考えていたのですが、どちらの方法よりも遅いので結局使われませんでした。

*** モーションキャンセル

- バックダッシュで攻撃モーションをキャンセルできます。有名ですね。
- 着地でも一部の武器の攻撃モーションをキャンセルできます。これも有名ですね。
- アーマーナイトのソウルでダメージ後の着地モーションをキャンセルできます。
- ブラックパンサーのソウルを着地寸前に解除すると、着地モーションを解除できます（高速移動時のモーションもキャンセル可能）。

*** 乱数

部屋によっては（より正確には敵・背景・その他効果等の状況によっては）乱数は毎フレーム変化しますし、そうでない場合もあります。

蒼真が乱数を変化させる手段としては、通常攻撃（1回変化）、バックダッシュ（発動中常に変化）、振り向き（1回変化）があります。ジャンプやしゃがみ、ソウル使用（少なくとも今回の動画で用いたもの）では変化させることができません。

バックダッシュ+しゃがみは、ほとんど速度を落とさずに乱数調整できるので便利です。もっとも大量に乱数を変化させる方法は、よいタイミングで左や右を連射するような感じかと思われます（今回用いなかっただけに、本当のところはわかりません）。

*** 速度を落とさずに足場をすり抜ける（未使用）

こちらがそのデモ映像です。

[http://www.youtube.com/watch?v=paUs8h3Quqg:movie]

動画を作り終わる頃に発見したものなので、現状で詳細を述べることはできませんが、限られたピクセル条件でのみ起こりうるトリックなのではないかと思います。次なる更新の種になるかもしれません。見栄えもいいしなったらいいなあ。

*** 壁抜けに関する基本的な情報

壁を抜けて部屋の外に行くと、既訪問フラグの書き込みが通常の範囲外のアドレスに対して行われます。その結果、ソウルやアイテムが増えたり、ワープが有効になったり、ゲームがフリーズしてしまったりする怪現象が起こるわけです。

つまるところ、この際の書き込みアドレスは蒼真の居場所に基づいて決定されています。

わたしは位置情報から書き込みアドレスを求める式を調べに調べて、

In other words, the write address is determined from Soma's location.
I studied how to calculate the exact write address from Soma's position,
and wrote up a lua script which shows the write address in realtime.
It definitely helped me to consider the optimal route of the zipping part.

*** メモリアドレス

にゃああ

** 謝辞

にゃああ













まさかこんなひどいルートを考えつくとは、Trailerを放出した頃には思ってもいませんでした。じつを言うとDeSmuME-rrに出会う以前は、<em>蒼月の十字架のスピードランについて考えたことなんてなかった</em>ほどなのです。

ある日、新しいDSエミュレータのTAS動画記録を試してみたかったわたしは、好奇心からこのゲームの開幕部（最初の敵3体との戦い）のTAS動画を書きました。そうしてゲームの動作の基本を学んだことから、ふと<a class="ex-ref" href="http://tasvideos.org/forum/p/200512#200512">TASvideosフォーラムにあるAtmaさんのTAS動画デモ</a>が更新できることに気づきます。これがこのゲームのTASに真剣に取り組み始めたきっかけでした。まさかわたしが、あの有名な悪魔城のTASに取り組むことになるだなんて、当初はまったく想像していませんでした。

<em>よぉし、まじめにやるぞー！ヽ(＞○＜)</em> と決めたところで、まずはYouTubeにあった<em><a class="ex-ref" href="http://www.youtube.com/watch?v=ws4714qAvk4">Grooboさんの追記動画</a></em>に目を通しました((追記動画の制作のもとになった<a class="ex-ref" href="http://www.youtube.com/watch?v=Qa0GjrK6KoY">Satoryuさんの実機スピードラン（multi-segment）</a>も鑑賞しました。ルートはどちらも同じです。))。これは<em>カタールによる扉が裏開けできるバグ</em>と、<em>サキュバスバグ（壁抜け・ソウル取得が可能）</em>という2つの有名なバグ（詳細は後述）を利用して、ゲームをわずか<em>28分58秒</em>でクリアする動画です。わたしの当初の狙いはこの動画を最適化することであり、クリアタイムはせいぜい20分を切らないくらいだろうと考えていました。

転機は偶然に訪れます。サキュバスバグの動作を理解しようと遊んでいたら、アクスでも壁抜けができることにふと気がつきました。その一方で、ふとボス戦後の会話でも必殺技をキャンセルできるのではないかと想像しました。わたしはすぐさまフライングアーマーを相手にアクスでの実行を試みました。

However, a revolution happens by chance.
When I was playing with Succubus glitch to understand how it works, I noticed that a zipping could be performed with Axe.
A little later, I guessed that a cutscene also can interrupt a special attack.
I tried to perform that at Flying Armor battle, and I proved that my guess is true.





just for curiosity

フレーム云々で手抜きはあるけど、戦略にぬかりはない。 *
どうしてこうなった
移動方法、バックダッシュとあれこれ *
同期 ???
部屋ごとのあれこれ
壁抜けについて（SGその他）
screenshot
バックダッシュなんとかの比較：平均速度
アーマーナイトによるダメージ時モーションの省略
乱数調整
メモリアドレス
